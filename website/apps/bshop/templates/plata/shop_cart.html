{% extends base_template|default:"base.html" %}

{% load i18n thumbnail plata_tags fd5_form_tags %}

{% block title %}{% trans "Cart" %} - {{ block.super }}{% endblock %}

{% block content %}

<section class="cart">

    {% if empty %}

    <div class="section-header">
        <div class="row">

            <div class="small-12 column">
                <h2>{% trans "Cart is empty!" %}</h2>
            </div>

            <div class="small-12 column">
                <div class="info">
                    <p>(( Text? ))</p>
                </div>
            </div>
        </div>
    </div>

    {% else %}


    <div class="section-header">
        <div class="row">

            <div class="small-12 column">
                <h2>{% trans "Cart" %}</h2>
            </div>

            <div class="small-12 column">
                <div class="info">
                    <p>(( Text? ))</p>
                </div>
            </div>
        </div>
    </div>


    {% with step=1 %}
    {% include "bshop/_checkout_progress.html" %}
    {% endwith %}


    <form method="post" action=".">

        {% csrf_token %}

        {{ orderitemformset.management_form }}


        <div class="discounts">


            <div class="row">
                <div class="small-12 columns">

                    <h3>{% trans "Voucher code" %}</h3>

                    <div class="row">
                        <div class="large-12 columns">
                            <div class="row collapse">

                                <div class="small-2 columns">
                                    <span class="prefix">Code</span>
                                </div>

                                <div class="small-7 columns">
                                    {% form_item_plain discount_form.code %}
                                </div>
                                <div class="small-3 columns">
                                    <button class="button simple_ postfix" type="submit" name="save_discount"><i class="fa fa-credit-card"></i>
                                        {% trans "Add voucher" %}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>
            </div>


            {% with order.applied_discounts.all as discounts %}

            {% if discounts %}
            <div class="block">
                <div class="row">

                    <div class="small-12 columns">
                        <h3>{% trans "Discounts" %}</h3>
                    </div>

                    {% for discount in discounts %}
                    <div class="small-3 columns">
                        <p>{{ discount.name }}</p>
                    </div>
                    <div class="small-9 columns">
                        <ul class="no-bullet">
                            <li>Code: {{ discount.code }}</li>

                            <!-- TODO: modularize type display -->
                            {% if discount.type == 20 %}
                            <li>{{ order.currency }} {{ discount.value|floatformat:2 }} {% trans "discount on order total" %}</li>
                            {% endif %}
                        </ul>

                    </div>
                    {% endfor %}

                </div>
            </div>
            {% endif %}

            {% endwith %}


        </div>






        {% form_errors orderitemformset %}

        <table class="cart" role="grid">
            <tr>
                <th>{% trans "product"|capfirst %}</th>
                <th>{% trans "unit price"|capfirst %}</th>
                <th>{% trans "quantity"|capfirst %}</th>
                <th>{% trans "line item price"|capfirst %}</th>
                <th>{% trans "Delete" %}</th>
            </tr>
            {% for orderitemform in orderitemformset.forms %}
            <tr>
                <td class="product-image" style="background-image: url({% thumbnail orderitemform.instance.product.images.front 160x100 crop upscale %});">
                    <p>
                        <a href="{{ orderitemform.instance.product.product.get_absolute_url }}">{{ orderitemform.instance.product.product }}</a><br>
                        {{ orderitemform.instance.product }}
                    </p>
                </td>
                <td>{{ orderitemform.instance.unit_price|floatformat:2 }}</td>
                <td>
                    {{Â orderitemform.id }}
                    {% form_item_plain orderitemform.quantity %}
                </td>
                <td>{{ orderitemform.instance.discounted_subtotal|floatformat:2 }}</td>
                <td>{% form_item_plain orderitemform.DELETE %}</td>
            </tr>
            {% endfor %}

        </table>

        <div class="row">
            <div class="small-12 columns">
                <ul class="button-group right simple bottom">
                    <li>
                        <button class="button simple small" type="submit" name="save"><i class="fa fa-floppy-o"></i> {% trans " Save" %}
                        </button>
                    </li>
                    <li>
                        <button class="button simple small" type="submit" name="checkout"><i class="fa fa-credit-card"></i> {% trans " Checkout" %}
                        </button>
                    </li>
                </ul>
            </div>
        </div>


    </form>
    {% endif %}


</section>
{% endblock %}
