{% load cms_tags compress sekizai_tags i18n menu_tags bplayer_tags backfeed_tags pushy_client_tags nunjucks_tags analytics raven %}<!doctype html>
<html class="no-js{% if user.is_authenticated %} is-authenticated{% endif %}" lang="{{ LANGUAGE_CODE }}">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0"/>

    <title>{% block title %}{% page_attribute 'page_title' %}{% endblock %}{% block title-page %}{% endblock %}</title>

    <meta name="description"
          content="{% block meta_description %}{% page_attribute 'meta_description' %}{% endblock %}{% block meta_description_page %}{% endblock %}"/>
    <meta name="keywords" content="{% block meta_keywords %}{% endblock %}"/>
    <meta name="author" content="palmbeach interactive"/>
    <meta name="generator" content="A.W.F."/>
    <meta name="version" content="14.05.01"/>

    <meta http-equiv="last-modified" content="{% page_attribute 'changed_date' %} UTC"/>

    {% block meta_opengraph %}{% endblock %}

    <link rel="icon" type="image/png" href="{{ STATIC_URL }}img/base/icon.png"/>

    <link rel="stylesheet" href="{{ STATIC_URL }}css/screen.css" id="style_light"/>
    <!--
    <link rel="stylesheet" href="{{ STATIC_URL }}css/screen-dark.css" id="style_dark" disabled />
    -->

    {% compress css %}

    <link rel="stylesheet" href="{{ STATIC_URL }}css/print.css" media="print"/>
    {% endcompress %}

    <!--[if lt IE 9]>
    <script src="{{ STATIC_URL }}js/browser_hacks/html5shiv.js"></script>
    <script src="{{ STATIC_URL }}js/browser_hacks/nwmatcher-1.2.5-min.js"></script>
    <script src="{{ STATIC_URL }}js/browser_hacks/selectivizr-1.0.3b.js"></script>
    <script src="{{ STATIC_URL }}js/browser_hacks/respond.min.js"></script>
    <![endif]-->

    {% render_block "css" postprocessor "compressor.contrib.sekizai.compress" %}

    <script src="{{ STATIC_URL }}js/lib/modernizr.js"></script>
    <script src="{{ STATIC_URL }}js/lib/jquery-2.1.0.js"></script>
    <script src="{{ STATIC_URL }}js/lib/fd5/foundation.min.js"></script>

    <!--<script src="{{ STATIC_URL }}turbolinks/turbolinks.js"></script>-->
    <script src="{{ STATIC_URL }}js/lib/textcomplete-0.3.3/jquery.textcomplete.js"></script>

    {% if settings.DEBUG %}
    <script src="{{ STATIC_URL }}bplayer/js/lib/sm2/soundmanager2.js"></script>
    {% else %}
    <script src="{{ STATIC_URL }}bplayer/js/lib/sm2/soundmanager2-nodebug-jsmin.js"></script>
    {% endif %}

    {% block link %}{% endblock link %}

    {% comment %}
    {% block script %}{% endblock script %}
    {% endcomment %}

    {% render_block "css" %}

    {% analytics %}

    <!--
    <script type="text/javascript" src="http://fast.fonts.net/jsapi/1ca04628-74f1-4059-8dd2-c91d0a2a63bc.js"></script>
    -->
</head>
<body id="base" class="{% block body_extra_class %}{% endblock %}" data-livebg__ data-bplayer_state="init">

{% cms_toolbar %}

<div id="navigation_container">

    <nav class="top-bar" data-topbar data-livebg>

        <ul class="title-area">
            <li class="name">
                <a href="/">
                    <div id="levelbridge_icon" class="logo-icon">
                        <ul>
                            <li><span style="height: 50%;"></span></li>
                            <li><span style="height: 90%;"></span></li>
                            <li><span style="height: 50%;"></span></li>
                            <li><span style="height: 40%;"></span></li>
                            <li><span style="height: 20%;"></span></li>
                            <li><span style="height: 30%;"></span></li>
                            <li><span style="height: 70%;"></span></li>
                        </ul>
                    </div>
                    <div class="logo-text">
                        <span>open broadcast</span>
                    </div>
                </a>
            </li>
            <li class="toggle-topbar"><a data-no-turbolink href="#">Menu <i class="fa fa-bars"></i></a></li>
        </ul>

        <!-- start: mobile version -->
        <section class="top-bar-section center show-for-small-only">
            <ul class="account">
                {% include "_layout/_accountbar.html" %}
            </ul>
            <ul class="main">
                {% show_menu 0 100 100 100 "_layout/_navigation.html" %}
            </ul>
        </section>
        <!-- end: mobile version -->


        <!-- start: desktop version -->
        <section class="top-bar-section center show-for-medium-up">
            <ul>
                {% show_menu 0 100 100 100 "_layout/_navigation.html" %}
            </ul>
        </section>

        <section class="top-bar-section right show-for-medium-up">
            <ul>
                {% include "_layout/_accountbar.html" %}
            </ul>
        </section>
        <!-- end: desktop version -->

    </nav>
</div>
<header>
    {% block teaser %}{% endblock %}
</header>


<div class="container" id="content_base">

    {% block splash %}<!-- passed by: cms_base.html -->{% endblock %}

    {% include "onair/container.html" %}
    {% include "achat/container.html" %}

    {% block main_content %}{% endblock %}

    {% bplayer_inline %}

    {% if user.is_authenticated %}
    {# backfeed_inline #}
    {% endif %}


    {% include "_layout/_site_messages.html" %}




</div>

<!-- dialog container -->
<div id="reveal_container" class="reveal-modal" data-reveal></div>

<!-- ? -->
<div id="at_content"></div>

<div id="fb-root"></div>


{% compress js %}
<script src="{{ STATIC_URL }}js/lib/jquery-ui-1.10.4.custom.js"></script>

<!-- other libraries -->
<!--<script src="{{ STATIC_URL }}js/lib/nunjucks-1.1.0/nunjucks.js"></script>-->
<!--<script src="{{ STATIC_URL }}js/lib/nunjucks-1.1.0/filters.js"></script>-->


<script src="{{ STATIC_URL }}js/lib/featherlight.js"></script>
<script src="{{ STATIC_URL }}js/lib/jquery.imageloader.js"></script>
<script src="{{ STATIC_URL }}js/lib/jquery.hoverIntent-1.8.0.js"></script>
<script src="{{ STATIC_URL }}js/lib/jquery.color-2.1.2.js"></script>
<script src="{{ STATIC_URL }}js/lib/jquery.address.js"></script>
<script src="{{ STATIC_URL }}js/lib/jquery.timeago-1.4.1.js"></script>
<script src="{{ STATIC_URL }}js/lib/jquery.tipso-1.0.5.js"></script>
<script src="{{ STATIC_URL }}js/lib/js.cookie.js"></script>

<!-- global scripts -->
<script src="{{ STATIC_URL }}js/lib/ba-debug.js"></script>
<script src="{{ STATIC_URL }}js/lib/md5.js"></script>
<script src="{{ STATIC_URL }}js/site.js"></script>
<script src="{{ STATIC_URL }}js/ajax-loader.js"></script>
<script src="{{ STATIC_URL }}js/util.base.js"></script>



<!-- app scripts -->
<script src="{{ STATIC_URL }}achat/js/base.js"></script>
<script src="{{ STATIC_URL }}alogin/js/base.js"></script>
<script src="{{ STATIC_URL }}bplayer/js/base.js"></script>
<script src="{{ STATIC_URL }}bplayer/js/levelbridge.js"></script>
<script src="{{ STATIC_URL }}onair/js/base.js"></script>
<script src="{{ STATIC_URL }}stationtime/js/base.js"></script>
<script src="{{ STATIC_URL }}remotelink/js/base.js"></script>

{% endcompress %}

<!-- scripts exposed by apps/templatetags -->
{% nunjucks_scripts %}
{% pushy_client_scripts %}

<script>


    {% if not settings.DEBUG %}
    window.console = {
        log: function() {},
        info: function() {},
        warn: function() {},
        debug: function() {}
    };
    {% endif %}


    //var nj = new nunjucks.Environment(new nunjucks.WebLoader('{{ STATIC_URL }}'));
    //nj = nunjucks_register_filters(nj);



    {% if user.is_authenticated %}
        var current_user = {
            id: {{ user.id }},
            username: '{{ user.username }}'
        }
    {% else %}
        var current_user = false;
    {% endif %}


    // define globally for debug purposes
    var onair;
    var bplayer;
    var achat;
    var stationtime;
    var remotelink;

    $(function() {

        /////////////////////////////////////////////
        // site
        /////////////////////////////////////////////
        var site_ui = new SiteUI();
        site_ui.debug = false;
        site_ui.init();


        /////////////////////////////////////////////
        // AJAX Login App
        /////////////////////////////////////////////
        var login_app = new AloginApp();
        login_app.debug = true;
        login_app.login_url = "{% url 'alogin-login' %}";
        login_app.user = current_user;
        login_app.init();


        /////////////////////////////////////////////
        // AJAX Loader
        /////////////////////////////////////////////
        var ajax_loader = new AJAXLoader();
        ajax_loader.debug = false;
        ajax_loader.init();


        /////////////////////////////////////////////
        // player
        /////////////////////////////////////////////
        bplayer = new BPlayerApp();
        bplayer.debug = false;
        bplayer.mode = 'inline';
        bplayer.stream_url = '{{ settings.STREAM_URL }}';
        bplayer.static_url = '{{ STATIC_URL }}';
        bplayer.base_url = '{{ settings.STATIC_BASE_URL }}';

        var lb = new LevelBridge();

        setTimeout(function () {
            bplayer.init();
            lb.init(); // TODO: disabled for now
        }, 200);


        /////////////////////////////////////////////
        // chat
        /////////////////////////////////////////////
        achat = new AchatApp();
        achat.debug = false;
        achat.container = $('#achat_container');
        achat.static_url = '{{ STATIC_URL }}';
        achat.base_url = '{{ settings.STATIC_BASE_URL }}';
        achat.user = current_user;

        setTimeout(function () {
            achat.init();
            achat.load();
        }, 200);


        /////////////////////////////////////////////
        // on-air
        /////////////////////////////////////////////
        onair = new OnAirApp();
        onair.debug = true;
        onair.bplayer = bplayer;
        onair.base_url = '{{ settings.STATIC_BASE_URL }}';
        onair.use_history = {% if settings.ONAIR_LOAD_HISTORY %}true{% else %}false{% endif %};
        setTimeout(function () {
            onair.init();
        }, 100);


        /////////////////////////////////////////////
        // station time
        /////////////////////////////////////////////
        stationtime = new StationTimeApp();
        stationtime.debug = true;
        stationtime.api_url = "{% url 'stationtime-current-time' %}";
        stationtime.container = $('#station_time');
        setTimeout(function () {
            stationtime.init();
        }, 1000);


        /////////////////////////////////////////////
        // remote links
        /////////////////////////////////////////////
        remotelink = new RemotelinkApp();
        remotelink.debug = false;
        remotelink.dialog_url = "{% url 'remotelink-dialog' %}";
        remotelink.user = current_user;
        remotelink.init();



    });


</script>


{% render_block "js_ext" %}
{% render_block "js" postprocessor "compressor.contrib.sekizai.compress" %}

{% render_block "js-post" %}

<!--[if lt IE 9]>
<script src="{{ STATIC_URL }}js/browser_hacks/rem.js"></script>
<![endif]-->


    <script src="//cdn.ravenjs.com/1.1.15/jquery,native/raven.min.js"></script>
    <script>

        Raven.config('{% sentry_public_dsn %}', {
            //whitelistUrls: []
        }).install();

        {% if user.is_authenticated %}
            Raven.setUser({
                email: '{{ user.email }}',
                id: '{{ user.pk }}'
            });
        {% endif %}

    </script>

</body>
</html>
